<div class = 'px-5 pt-3'>
    
    <mat-card class = 'mat-elevation-z4'>

        <mat-card-title>

            <div class = 'pt-3 pl-3 pb-2'>
                Guia de Métricas
                <i [routerLink] = '["/nova-tarefa"]' class="text-primary pl-2 fa fa-plus cursor-pointer" aria-hidden="true"></i>

            </div>
            <mat-divider></mat-divider>
        </mat-card-title>
      

        
        <div>

            <mat-card-content class = 'mat-elevation-z4 mt-4'> 
                <mat-sidenav-container autosize>

                    <mat-sidenav opened mode="side" class = 'mat-elevation-z4'>

                        <ul class="list-group list-group-flush">
                            <li (click) = 'this.filtraDisciplina(i.id);' class="list-group-item sidenav-el" *ngFor = 'let i of this.listaDisciplinasGuia'>
                                {{i.id + ' - ' + i.descricao}}                                 
                            </li>  
                        </ul>       
                                   
    
                    </mat-sidenav>

                    <mat-sidenav-content>
                        <div class = 'wrapper mt-2 ml-4'>
                            <mat-form-field>
                                <mat-label>Filtrar</mat-label>
                                <input matInput (keyup)="applyFilter($event)" placeholder="Ex. 2.1.2">
                              </mat-form-field>

                            <table mat-table [dataSource]="this.dataSource" multiTemplateDataRows class = 'mat-elevation-z4'>                     
                       
                                <ng-container matColumnDef="tarefa">
                                    <th mat-header-cell *matHeaderCellDef> Tarefa </th>
                                    <td mat-cell *matCellDef="let element">

                                        <div class="container">
                                            <div class="row">
                                                <div class="col-sm-11 px-0"
                                                [class.example-expanded-row]="expandedElement === element"
                                                (click)="expandedElement = expandedElement === element ? null : element">
                                                    {{element.tarefa + ' - ' + element.descricao_tarefa}} 
                                                </div>
                                                <div (click) = 'this.open(content, element);'  class="col-sm-1 d-flex justify-content-center">
                                                    <i class="fa fa-2x fa-ellipsis-h" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                        </div>

                                    </td>
                                </ng-container>   

                                <ng-container matColumnDef="expandedDetail">

                                    <td mat-cell *matCellDef="let element" [attr.colspan]="colunas.length">
                                      <div class="example-element-detail"
                                           [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">  

                                        <div>
                                            <mat-expansion-panel class = 'mat-elevation-z4 mb-2' *ngFor = 'let i of this.agrupaComplexidadesTrf(element.itens)'>
                                                <mat-expansion-panel-header class = 'bg-secondary'>
                                                    <mat-panel-title class = 'text-light'>
                                                        {{i}}
                                                    </mat-panel-title> 
                                                </mat-expansion-panel-header>                                                  
                                               <hr>
                                                <table class="table mt-2 mb-2 mat-elevation-z4 fonte-item-guia">
                                                    <thead class="thead-dark">
                                                    <tr>
                                                        <th scope="col">Valor</th>  
                                                        <th scope="col">Componente</th> 
                                                        <th scope="col">Descrição</th>                                                     
                                                      </tr>
                                                    </thead>
                                                    <tbody>
                                                      <tr *ngFor='let j of this.filtraTrfPorComplexidade(element.itens, i)'>                                                        
                                                        <td>{{j.valor}}</td>     
                                                        <td>{{this.isNull(j.componente) ? "N/A" : j.componente}}</td>  
                                                        <td>{{this.isNull(j.descricao_complex) ? "N/A" : j.descricao_complex}}</td>                                                     
                                                      </tr>                                                 
                                                    </tbody>
                                                </table>                                          

                                            </mat-expansion-panel> 
                                        </div>

                                      </div>
                                    </td>

                                  </ng-container>                   
                            
                                <tr mat-header-row *matHeaderRowDef="colunas; sticky: true"></tr>
                                <tr mat-row *matRowDef="let element; columns: colunas;"
                                class="example-element-row"></tr>

                                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
    
                            </table>
                            <mat-paginator [pageSizeOptions]="[10, 20]" showFirstLastButtons class = 'mat-elevation-z4'></mat-paginator>
                        </div>

                    </mat-sidenav-content>
                                
                </mat-sidenav-container>
    
                      
              
            </mat-card-content>
        </div>

    </mat-card>

</div>

<ng-template #content let-c="close" let-d="dismiss">
    <div class="modal-header">
        <h5 class="modal-title" id="modal-basic-title">Editar Tarefa</h5>
        <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <div class="modal-body">
        
        <div class = 'container'>

            <div class = 'row'>
                <div class = 'col-sm-2'>
                    Tarefa
                </div>
                <div class = 'col-sm-10'>
                    <input readonly type="text" class = 'form-control' value = {{this.trfSelecionada.tarefa}} />
                </div>
            </div>

            <div class = 'row mt-1'>
                <div class = 'col-sm-2'>
                    Descrição
                </div>
                <div class = 'col-sm-10'>
                    <textarea (keyup) = "this.atualizaTrfSelecionada('N/A', 'N/A', 'descricao_trf', $event.target.value)" class = 'form-control'>{{this.trfSelecionada.descricao_tarefa}}</textarea>
                </div>
            </div>    
            
            <div class = 'row mt-1'>
                <div class = 'col-sm-2'>
                    Plataforma
                </div>
                <div class = 'col-sm-10'>
                    <textarea (keyup) = "this.atualizaTrfSelecionada('N/A', 'N/A', 'plataforma', $event.target.value)" class = 'form-control'>{{this.filtraVlrNull(this.trfSelecionada.plataforma)}}</textarea>
                </div>
            </div> 

            <div class = 'row' *ngFor = 'let i of this.agrupaComplexidadesTrf(this.trfSelecionada.itens)'>

                <div class = 'col-sm-12'>

                    <mat-expansion-panel class = 'mat-elevation-z4 mt-2'>
                        <mat-expansion-panel-header class = 'bg-secondary'>
                            <mat-panel-title class = 'text-light'>
                                {{i}}
                            </mat-panel-title> 
                        </mat-expansion-panel-header>         

                        <div class = 'container'>
                            <div class = 'row'>                       

                                <table class="table mat-elevation-z4 mt-2 fonte-item-guia">
                                    <thead class="thead-dark">
                                    <tr>
                                        <th scope="col">Valor</th>  
                                        <th scope="col">Componente</th> 
                                        <th scope="col">Descrição</th>      
                                        <th scope="col">Quantidade</th>                                                
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr *ngFor='let j of this.filtraTrfPorComplexidade(this.trfSelecionada.itens, i)'>                                                        
                                        <td>
                                            <input (keyup) = "this.atualizaTrfSelecionada(i, j.componente, 'valor', $event.target.value)" class = 'form-control form-control-sm' type="text" value = {{j.valor}} />
                                        </td>     
                                        <td>
                                            <input (keyup) = "this.atualizaTrfSelecionada(i, j.componente, 'componente', $event.target.value)" class = 'form-control form-control-sm' type="text" value = {{this.filtraVlrNull(j.componente)}} />
                                        </td>                                          
                                        <td>
                                            <textarea (keyup) = "this.atualizaTrfSelecionada(i, j.componente, 'descricao_complex', $event.target.value)" class = 'form-control form-control-sm' value = {{this.filtraVlrNull(j.descricao_complex)}}></textarea>
                                        </td>  
                                        <td>
                                            <input (keyup) = "this.atualizaTrfSelecionada(i, j.componente, 'quantidade', $event.target.value)" class = 'form-control form-control-sm' type="text" value = {{this.filtraVlrNull(j.quantidade)}} />
                                           
                                        </td>  

                                      </tr>                                                 
                                    </tbody>
                                </table>   
                            </div>




                        </div>
               





                    </mat-expansion-panel> 

                </div>
            </div>   
        </div>
    </div>  
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="c('Save click')">Cancelar</button>
        <button type="button" class="btn btn-success" (click)="this.submit(); c('Save click');">Salvar</button>
    </div>
 
</ng-template>

