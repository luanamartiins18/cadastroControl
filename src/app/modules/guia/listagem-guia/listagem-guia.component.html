<div class='px-5 pt-3'>
  <mat-card class='mat-elevation-z4'>
    <mat-card-title>
      <div class='pt-3 pl-3 pb-2' *ngIf='this.cargoUsuario;'>
        Guia de Métricas
        <span class='lead text-muted small-text'>
          Versão: {{this.versaoAtualGuia}}
        </span>
        <div class='float-right fonte-menu-guia pr-3' *ngIf='this.cargoUsuario.id != 3'>
          <div (click)='this.openModalVersao(modalVersao);' class="pl-2 cursor-pointer op-menu-guia" aria-hidden="true">
            Versão
          </div>
        </div>
        <div class='float-right fonte-menu-guia pr-3' *ngIf='this.cargoUsuario.id != 3'>
          <div [routerLink]='["/nova-tarefa"]' class="pl-2 cursor-pointer op-menu-guia" aria-hidden="true">
            Nova Tarefa
          </div>
        </div>
      </div>
      <mat-divider></mat-divider>
    </mat-card-title>
    <div>
      <mat-card-content class='mat-elevation-z4 mt-4'>
        <mat-sidenav-container autosize>
          <mat-sidenav opened mode="side" class='mat-elevation-z4'>
            <ul class="list-group list-group-flush">
              <li (click)='this.filtraDisciplina(i.id);' class="list-group-item sidenav-el"
                *ngFor='let i of this.listaDisciplinasGuia'>
                {{i.id + ' - ' + i.descricao}}
              </li>
            </ul>
          </mat-sidenav>
          <mat-sidenav-content>
            <div class='wrapper mt-2 ml-4'>
              <mat-form-field>
                <mat-label>Filtrar</mat-label>
                <input matInput (keyup)="applyFilter($event)" placeholder="Ex. 2.1.2">
              </mat-form-field>
              <table mat-table [dataSource]="this.dataSource" multiTemplateDataRows class='mat-elevation-z4'>
                <ng-container matColumnDef="tarefa">
                  <th mat-header-cell *matHeaderCellDef> Tarefa </th>
                  <td mat-cell *matCellDef="let element">
                    <div class="container">
                      <div class="row">
                        <div class="col-sm-11 px-0" [class.example-expanded-row]="expandedElement === element"
                          (click)="expandedElement = expandedElement === element ? null : element">
                          {{element.tarefa + ' - ' + element.descricao_tarefa}}
                        </div>
                        <div (click)='this.open(content, element);' class="col-sm-1 d-flex justify-content-center">
                          <i class="fa fa-2x fa-ellipsis-h" aria-hidden="true" *ngIf='this.cargoUsuario.id != 3'>
                          </i>
                        </div>
                      </div>
                    </div>
                  </td>
                </ng-container>
                <ng-container matColumnDef="expandedDetail">
                  <td mat-cell *matCellDef="let element" [attr.colspan]="colunas.length">
                    <div class="example-element-detail"
                      [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                      <div>
                        <mat-expansion-panel class='mat-elevation-z4 mb-2'
                          *ngFor='let i of this.agrupaComplexidadesTrf(element.itens)'>
                          <mat-expansion-panel-header class='bg-secondary'>
                            <mat-panel-title class='text-light'>
                              {{i}}
                            </mat-panel-title>
                          </mat-expansion-panel-header>
                          <hr>
                          <table class="table mt-2 mb-2 mat-elevation-z4 fonte-item-guia">
                            <thead class="thead-dark">
                              <tr>
                                <th scope="col">Valor</th>
                                <th scope="col">Componente</th>
                                <th scope="col">Descrição</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor='let j of this.filtraTrfPorComplexidade(element.itens, i)'>
                                <td>{{j.valor}}</td>
                                <td>{{this.isNull(j.componente) ? "N/A" : j.componente}}</td>
                                <td>{{this.isNull(j.descricao_complex) ? "N/A" : j.descricao_complex}}</td>
                              </tr>
                            </tbody>
                          </table>
                        </mat-expansion-panel>
                      </div>
                    </div>
                  </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="colunas; sticky: true"></tr>
                <tr mat-row *matRowDef="let element; columns: colunas;" class="example-element-row"></tr>
                <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
              </table>
              <mat-paginator [pageSizeOptions]="[10, 20]" showFirstLastButtons class='mat-elevation-z4'></mat-paginator>
            </div>
          </mat-sidenav-content>
        </mat-sidenav-container>
      </mat-card-content>
    </div>
  </mat-card>
</div>
<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h5 class="modal-title" id="modal-basic-title">Editar Tarefa</h5>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class='container'>
      <div class='row'>
        <div class='col-sm-2'>
          Tarefa
        </div>
        <div class='col-sm-10'>
          <input readonly type="text" class='form-control' value={{this.trfSelecionada.tarefa}} />
        </div>
      </div>
      <div class='row mt-1'>
        <div class='col-sm-2'>
          Descrição
        </div>
        <div class='col-sm-10'>
          <textarea (keyup)="this.atualizaTrfSelecionada('N/A', 'N/A', 'descricao_trf', $event.target.value)"
            class='form-control'>{{this.trfSelecionada.descricao_tarefa}}</textarea>
        </div>
      </div>
      <div class='row mt-1'>
        <div class='col-sm-2'>
          Plataforma
        </div>
        <div class='col-sm-10'>
          <textarea (keyup)="this.atualizaTrfSelecionada('N/A', 'N/A', 'plataforma', $event.target.value)"
            class='form-control'>{{this.filtraVlrNull(this.trfSelecionada.plataforma)}}</textarea>
        </div>
      </div>
      <hr>
      <h5 class='mt-3'>
        Itens da Tarefa
      </h5>
      <div class='row' *ngFor='let i of this.agrupaComplexidadesTrf(this.trfSelecionada.itens); let ind = index;'>
        <div class='col-sm-11'>
          <mat-expansion-panel class=' mat-elevation-z4 mt-2'>
            <mat-expansion-panel-header class='bg-secondary'>
              <mat-panel-title class='text-light'>
                {{i}}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div class='container'>
              <div class='row'>
                <table class="table mat-elevation-z4 mt-2 fonte-item-guia">
                  <thead class="thead-dark">
                    <tr>
                      <th scope="col">Valor</th>
                      <th scope="col">Componente</th>
                      <th scope="col">Descrição</th>
                      <th scope="col">Quantidade</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor='let j of this.filtraTrfPorComplexidade(this.trfSelecionada.itens, i)'>
                      <td>
                        <input (keyup)="this.atualizaTrfSelecionada(i, j.componente, 'valor', $event.target.value)"
                          class='form-control form-control-sm' type="text" value={{j.valor}} />
                      </td>
                      <td>
                        <input (keyup)="this.atualizaTrfSelecionada(i, j.componente, 'componente', $event.target.value)"
                          class='form-control form-control-sm' type="text" value={{this.filtraVlrNull(j.componente)}} />
                      </td>
                      <td>
                        <textarea
                          (keyup)="this.atualizaTrfSelecionada(i, j.componente, 'descricao_complex', $event.target.value)"
                          class='form-control form-control-sm'
                          value={{this.filtraVlrNull(j.descricao_complex)}}></textarea>
                      </td>
                      <td>
                        <input (keyup)="this.atualizaTrfSelecionada(i, j.componente, 'quantidade', $event.target.value)"
                          class='form-control form-control-sm' type="text" value={{this.filtraVlrNull(j.quantidade)}} />
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </mat-expansion-panel>
        </div>
        <div class='col-sm-1 d-flex align-items-center'>
          <i class="fa fa-times fa-2x text-danger cursor-pointer" aria-hidden="true"
            (click)='this.openModalApagarItem(modalApagarItem, this.trfSelecionada.itens[ind].id_item);'>
          </i>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button id='btnFecharModalEditar' type="button" class="btn btn-danger" (click)="c('Save click')">Cancelar</button>
    <button type="button" class="btn btn-success" (click)="this.submit(); c('Save click');">Salvar</button>
  </div>
</ng-template>
<ng-template #modalVersao let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Atualizar Versão</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body d-flex flex-row align-items-center">
    <h6>
      Versão
    </h6>
    <input type="text" id='inputVersaoGuia' class='ml-4 form-control sm-width' [(ngModel)]='this.valorVersao'
      (keydown)='this.onEnter($event)'>
  </div>
  <div class="modal-footer">
    <button id='btnCancelar' type="button" class="btn btn-outline-secondary" (click)="c('Save click')">Cancelar</button>
    <button type="button" class="btn btn-outline-primary" (click)="c('Save click'); this.submitVersaoGuia();">Atualizar
      Versão</button>
  </div>
</ng-template>
<ng-template #modalApagarItem let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Deletar Item</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <i class="d-flex justify-content-center fa fa-exclamation-circle fa-4x deletar" aria-hidden="true"></i>
    <h4 class="d-flex justify-content-center">Você tem certeza?</h4>
    <p class='text-muted d-flex justify-content-center'>O item será deletada permanentemente</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" (click)="c('Save click')">Cancelar</button>
    <button type="button" class="btn btn-outline-danger" (click)="c('Save click'); this.excluiItem();">Excluir
      Item</button>
  </div>
</ng-template>
<ng-template #carregando>
  <div class='wrapper d-flex justify-content-center align-items-center'>
    <i class="fa fa-refresh fa-spin fa-5x" aria-hidden="true"></i>
  </div>
</ng-template>