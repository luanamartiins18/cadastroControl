<div class='mt-1 container-fluid px-0'>
  <div class='container px-0 mt-2'>
    <div class='row'>
      <div class='col-sm-6'>
        <h5>Ordem de Fornecimento - {{this.numOf}}</h5>
      </div>
    </div>
  </div>
  <div class='container px-0 mt-2'>
    <div class='row'>
      <div class='col-sm-6'>
        <ul class="nav nav-tabs mb-3" id="pills-tab" role="tablist">
          <li class="nav-item">
            <a (click)='this.setaTab("minhas-tarefas")'
              [ngClass]='{"active": this.tabAtiva == "minhas-tarefas", "show": this.tabAtiva == "minhas-tarefas" }'
              class="nav-link" id="pills-home-tab" data-toggle="pill" href="#minhas-tarefas" role="tab"
              aria-controls="pills-home" aria-selected="true">
              Minhas Tarefas
            </a>
          </li>
          <li class="nav-item">
            <a (click)='this.setaTab("nova-tarefa")'
              [ngClass]='{"active": this.tabAtiva == "nova-tarefa", "show": this.tabAtiva == "nova-tarefa" }'
              class="nav-link" id="pills-profile-tab" data-toggle="pill" href="#" role="tab"
              aria-controls="pills-profile" aria-selected="false">
              Nova Tarefa
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="tab-content" id="pills-tabContent">
    <div [ngClass]='{"active": this.tabAtiva == "nova-tarefa", "show": this.tabAtiva == "nova-tarefa" }'
      class="tab-pane fade" id="nova-tarefa" role="tabpanel" aria-labelledby="pills-home-tab">
      <div class='container'>
        <div [formGroup]='form' class='row'>
          <div class='col-sm-12 d-flex justify-content-center mb-3'>
            <h5>Dados da Tarefa</h5>
          </div>
          <div class='col-sm-2 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Nº Tarefa
            </label>
          </div>
          <div class='col-sm-3'>
            <input formControlName='numTarefa' mask='000000000000' type='text' class='form-control form-control-sm' />
          </div>
          <div class='col-sm-2 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Sprint
            </label>
          </div>
          <div class='col-sm-3'>
            <select formControlName='sprint' class='form-control form-control-sm'>
              <option value='1º Quinzena'>
                1º Quinzena
              </option>
              <option value='2º Quinzena'>
                2º Quinzena
              </option>
            </select>
          </div>
          <div class='col-sm-2'></div>
          <div class='col-sm-2 d-flex justify-content-end mt-2'>
            <label class='font-weight-bold'>
              Artefato
            </label>
          </div>
          <div class='col-sm-3 mt-2'>
            <input formControlName='artefato' class='form-control form-control-sm' type='text' />
          </div>
          <div class='col-sm-2 mt-2 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              História
            </label>
          </div>
          <div class='col-sm-3 mt-2'>
            <input formControlName='historia' class='form-control form-control-sm' type='text' />
          </div>
          <div class='col-sm-2'></div>

          <div class='col-sm-2 d-flex justify-content-end mt-3'>
            <label class='font-weight-bold'>
              Observação
            </label>
          </div>
          <div class='col-sm-8 mt-2'>
            <textarea formControlName='observacao' rows="1" class='form-control form-control-sm'>
                        </textarea>
          </div>
          <div class='col-sm-2'></div>
          <div class='col-sm-12 d-flex justify-content-center mt-3'>
            <h5>Dados do Guia</h5>
          </div>
          <div class='col-sm-2 mt-3 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Perfil
            </label>
          </div>
          <div class='col-sm-3 mt-3'>
            <select formControlName='perfil' class='form-control form-control-sm'>
              <option value='1'>
                Baixa
              </option>
              <option value='2'>
                Alta
              </option>
            </select>
          </div>
          <div class='col-sm-2 mt-3 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Disciplina
            </label>
          </div>
          <div class='col-sm-3 mt-3'>
            <select (change)='this.filtraItensGuia();' formControlName='disciplina'
              class='form-control form-control-sm'>
              <option *ngFor='let i of this.listaDisciplinas' [value]='i.id'>
                {{ i.id != 0 ? i.id + ' - ' : ""}}
                {{i.descricao}}
              </option>
            </select>
          </div>
          <div class='col-sm-2'></div>
          <div class='col-sm-2 mt-2 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Item
            </label>
          </div>
          <div class='col-sm-3 mt-2'>
            <button [ngbTooltip]='this.itemSelecionado' [disabled]='!this.btnItem'
              [ngClass]='{"btn-info": this.btnItem, "btn-secondary": !this.btnItem}' type="button"
              class="item-selecionado btn form-control form-control-sm" data-toggle="modal" data-target="#exampleModal">
              {{this.itemSelecionado != "" ? this.itemSelecionado : "Selecione um Item..."}}
            </button>
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Escolha um Item</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class='lista-itens-guia'>

                      <div data-dismiss="modal" (click)='this.selecionaTarefa(i);' class='item-guia'
                        *ngFor='let i of this.listaItensGuia  | slice: (this.page-1) * this.pageSize : (this.page-1) * this.pageSize + this.pageSize'>
                        {{i.tarefa + ' - ' + i.descricao_tarefa}}
                      </div>
                      <div class='pt-2'>
                        <ngb-pagination [(page)]="this.page" [pageSize]="this.pageSize"
                          [collectionSize]="this.listaItensGuia?.length"></ngb-pagination>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class='col-sm-2 mt-2 d-flex justify-content-end' *ngIf='this.trfPossuiQuantidade'>
            <label class='font-weight-bold'>
              Quantidade
            </label>
          </div>
          <div class='col-sm-3 mt-2' *ngIf='this.trfPossuiQuantidade'>
            <input formControlName='quantidade' mask='000000000000' type='text' class='form-control form-control-sm' />
          </div>
          <div class='col-sm-2' *ngIf='this.trfPossuiQuantidade'></div>
          <div class='col-sm-7' *ngIf='!this.trfPossuiQuantidade'></div>
          <div *ngIf='this.listaComponentesTrf.length > 0' class='col-sm-2 mt-2 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Componente
            </label>
          </div>
          <div *ngIf='this.listaComponentesTrf.length > 0' class='col-sm-3 mt-2'>
            <select formControlName='componente' class='form-control form-control-sm'>
              <option selected disabled hidden></option>
              <option [value]='i' *ngFor='let i of this.listaComponentesTrf'>
                {{i}}
              </option>
            </select>
          </div>
          <div *ngIf='this.listaComponentesTrf.length > 0 && this.listaComplexidadesTrf == 0' class='col-sm-7'></div>
          <div *ngIf='this.listaComplexidadesTrf.length > 0' class='col-sm-2 mt-2 d-flex justify-content-end'>
            <label class='font-weight-bold'>
              Complexidade
            </label>
          </div>
          <div *ngIf='this.listaComplexidadesTrf.length > 0' class='col-sm-3 mt-2'>
            <select formControlName='complexidade' class='form-control form-control-sm'>
              <option selected disabled hidden></option>
              <option [value]='i' *ngFor='let i of this.listaComplexidadesTrf'>
                {{i}}
              </option>
            </select>
          </div>
          <div *ngIf='this.listaComplexidadesTrf.length > 0 && this.listaComponentesTrf == 0' class='col-sm-7'></div>
          <div class='col-sm-4'></div>
          <div class='col-sm-4 mt-4 text-success d-flex justify-content-center'>
            <button (click)='this.resetForm();' class="form-control bg-danger text-white mr-2">
              Cancelar
            </button>
            <button [ngClass]="{'bg-success': this.opFormTrf == 'Salvar', 'bg-primary': this.opFormTrf == 'Atualizar'}"
              (click)='this.submit();' class='form-control text-white'>
              {{this.opFormTrf}} Tarefa
            </button>
          </div>
        </div>
      </div>
    </div>
    <div [ngClass]='{"active": this.tabAtiva == "minhas-tarefas", "show": this.tabAtiva == "minhas-tarefas" }'
      class="tab-pane fade show" id="minhas-tarefas" role="tabpanel" aria-labelledby="pills-profile-tab">
      <div class='container px-0 mb-5' *ngIf='this.listaTarefas.length > 0; else naoHaTarefas'>
        <div>
          <table mat-table [dataSource]="this.listaTarefas" class='mat-elevation-z8'>
            <ng-container matColumnDef="numTarefa">
              <th mat-header-cell *matHeaderCellDef> Nº Tarefa </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.numTarefa}} </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="artefato">
              <th class='pr-4' mat-header-cell *matHeaderCellDef> Artefato </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.artefato}} </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="sprint">
              <th mat-header-cell *matHeaderCellDef> Sprint </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.sprint}} </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="quantidade">
              <th mat-header-cell *matHeaderCellDef> Quantidade </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.quantidade}} </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="historia">
              <th mat-header-cell *matHeaderCellDef> História </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.historia}} </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="situacao">
              <th mat-header-cell *matHeaderCellDef> Situação </th>
              <td class='pr-5' mat-cell *matCellDef="let element">
                <select class='form-control' (change)='this.alteraSituacaoTrf($event.target.value, element.id);'>
                  <option (click)='this.alteraSituacaoTrf(i.id, element.id);'
                    [selected]='(i.id == element.fk_situacao) ? "selected": "" ' *ngFor='let i of this.listaSituacoes'
                    [value]='i.id'>
                    {{i.descricao}}
                  </option>
                </select>
              </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="tarefa">
              <th mat-header-cell *matHeaderCellDef> Tarefa </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.tarefa}} </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <ng-container matColumnDef="complexidade">
              <th mat-header-cell *matHeaderCellDef> Complexidade </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.complexidade}} </td>
              <td mat-footer-cell *matFooterCellDef>
                <div class='total mt-2'>Planejado</div>
                <div class='total'>Executado</div>
              </td>
            </ng-container>
            <ng-container matColumnDef="valor">
              <th mat-header-cell *matHeaderCellDef> Valor </th>
              <td (click)='this.tarefaAtual(element.id); this.editaTarefa(element);' mat-cell *matCellDef="let element">
                {{element.valor}} </td>
              <td mat-footer-cell *matFooterCellDef>
                <div class='total mt-2'>{{this.valorPlanejado}} </div>
                <div class='total'>{{this.valorExecutado}} </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="acoes">
              <th mat-header-cell *matHeaderCellDef> Opções </th>
              <td mat-cell *matCellDef="let element">
                <i (click)='open(content); this.tarefaAtual(element.id);' class="fa fa-times fa-2x deletar custom-icon"
                  aria-hidden="true" placement="top" ngbTooltip="Excluir"></i>
              </td>
              <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="colunas; sticky: true"></tr>
            <tr class='clickable-row' mat-row *matRowDef="let row; columns: colunas;"></tr>
            <tr mat-footer-row *matFooterRowDef="colunas;"></tr>
          </table>
        </div>
      </div>
    </div>
  </div>
  <ng-template #naoHaTarefas>
    <div class='container'>
      <div class="alert alert-warning" role="alert">
        Você ainda não possui tarefas cadastradas nessa Ordem de Fornecimento
      </div>
    </div>
  </ng-template>
</div>
<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Deletar Tarefa</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <i class="d-flex justify-content-center fa fa-exclamation-circle fa-4x deletar" aria-hidden="true"></i>
    <h4 class="d-flex justify-content-center">Você tem certeza?</h4>
    <p class='text-muted d-flex justify-content-center'>A tarefa será deletada permanentemente</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" (click)="c('Save click')">Cancelar</button>
    <button type="button" class="btn btn-outline-danger" (click)="c('Save click'); this.excluiTarefa();">Excluir
      Tarefa</button>
  </div>
</ng-template>