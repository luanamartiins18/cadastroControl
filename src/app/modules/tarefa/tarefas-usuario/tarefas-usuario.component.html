<div class = 'mt-1 container-fluid' >
    <i [routerLink] = '["/../ordem-fornecimento/usuario/" + this.idUsu]' class="custom-icon fa fa-arrow-left ico fa-2x"></i>  

    <div class = 'container px-0 mt-2'>
        <div class = 'row'>
            <div class = 'col-sm-6'>
                <h5 class = 'text-secondary'>Ordem de Fornecimento - {{this.numOf}}</h5>
               
            </div>
        </div>        
    </div>

    <div class = ' mt-2 container'>
      
        <div [formGroup] = 'form' class = ' row custom-row mat-elevation-z8'>

            
            <div class = 'container mt-2'>
                <div class = 'row'>
                    <div class = 'col-sm-12'>
                        <h5 class = 'custom-display'>Nova Tarefa</h5>
                        <i (click) = 'this.resetForm();' placement="top" ngbTooltip = "Resetar Formulário" *ngIf = 'this.opFormTrf == "Atualizar" ' class="custom-icon ml-2 fa fa-refresh fa-rotate-90" aria-hidden="true"></i>
                        <hr>
                    </div>
                </div>
                
            </div>

            <div class = 'col-sm-2 mt-2'>
                <label class = 'font-weight-bold'>
                    Nº Tarefa
                </label>
                <input formControlName = 'numTarefa' mask = '000000000000' type = 'text' class = 'form-control'/> 
            </div>
            
            <div class = 'col-sm-2'>
                <label class = 'font-weight-bold'>
                    Sprint
                </label>
    
                <select formControlName = 'sprint' class = 'form-control'>

                    <option value = '1º Quinzena'>
                        1º Quinzena
                    </option>

                    <option value = '2º Quinzena'>
                        2º Quinzena
                    </option>

                </select>
            </div>

            <div class = 'col-sm-3'>
                <label class = 'font-weight-bold'>
                    Observação
                </label>
    
                <textarea formControlName = 'observacao' rows = "1" class = 'form-control'>

                </textarea>
            </div>

            <div class = 'col-sm-3'>
                <label class = 'font-weight-bold'>
                    Artefato
                </label>
    
                <input formControlName = 'artefato' class = 'form-control' type = 'text' />
            </div>

            <div class = 'col-sm-2'>
                <label class = 'font-weight-bold'>
                    Perfil
                </label>
                <select (change) = 'this.setaPerfil();' formControlName = 'perfil' class = 'form-control'>
                    <option value = '1'>
                        Baixa
                    </option>
                    <option value = '2'>
                        Alta
                    </option>

                </select>
            </div>

            <div class = 'col-sm-3 mt-2'>
                <label class = 'font-weight-bold'>
                    Disciplina
                </label>
                <select (change) = 'this.setaItem();' formControlName = 'disciplina' class = 'form-control'>
                    <option value = '0' selected disabled hidden></option>
                    <option *ngFor='let i of this.listaDisciplinas' [value] = 'i.id'>
                        {{i.id + ' - ' + i.descricao}}
                    </option>
                </select>       
            </div>
            
            <div class = 'col-sm-5 mt-2'>

                <label class = 'font-weight-bold'>
                    Item
                </label>

                <select formControlName = 'item' class = 'form-control'>
              
                    <option value = '0' selected disabled hidden></option>
                    <option *ngFor='let i of this.listaItensGuia' [value] = 'i.id'>
                        {{i.item}}
                    </option>


                </select>   
            </div>


            <div class = 'col-sm-2'>
                <label class = 'font-weight-bold'>
                    História
                </label>
    
                <input formControlName = 'historia' class = 'form-control' type = 'text' />
            </div>

            <div class = 'col-sm-2 mt-2'>
                <label class = 'font-weight-bold'>
                    Quantidade
                </label>
                <input formControlName = 'quantidade' mask = '000000000000' type = 'text' class = 'form-control'/> 
            </div>

      
             <div class = 'col-sm-5'></div>

            <div class = 'col-sm-2 mt-3 text-success d-flex justify-content-center'>
                <button [ngClass] = "{'bg-success': this.opFormTrf == 'Salvar', 'bg-primary': this.opFormTrf == 'Atualizar'}" (click) = 'this.submit();' class = 'form-control text-white'>
                    {{this.opFormTrf}} Tarefa
                </button>
            </div>           
        </div>
    </div>

    <div class = 'container px-0 mt-4'>
        <div class = 'row'>
            <div class = 'col-sm-6'>
                <h5 class = 'text-secondary'>Minhas Tarefas</h5>
                <hr>
            </div>
        </div>        
    </div>

    <div *ngIf = 'this.listaTarefas.length > 0; else naoHaTarefas'>
        <div class = 'container px-0 mb-5'>
            <table mat-table [dataSource]="this.listaTarefas" class = 'mat-elevation-z8' >
                
                <ng-container matColumnDef="historia">
                    <th mat-header-cell *matHeaderCellDef> História </th>
                    <td mat-cell *matCellDef="let element"> {{element.historia}} </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>
        
                <ng-container matColumnDef="artefato">
                    <th class = 'pr-4' mat-header-cell *matHeaderCellDef> Artefato </th>
                    <td mat-cell *matCellDef="let element"> {{element.artefato}} </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>
        
                <ng-container matColumnDef="sprint">
                    <th mat-header-cell *matHeaderCellDef> Sprint </th>
                    <td mat-cell *matCellDef="let element"> {{element.sprint}} </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>
        
                <ng-container matColumnDef="quantidade">
                    <th mat-header-cell *matHeaderCellDef> Quantidade </th>
                    <td mat-cell *matCellDef="let element"> {{element.quantidade}} </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>

                <ng-container matColumnDef="numTarefa">
                    <th mat-header-cell *matHeaderCellDef> Nº Tarefa </th>
                    <td mat-cell *matCellDef="let element"> {{element.numTarefa}} </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>
                
                <ng-container matColumnDef="situacao">
                    <th mat-header-cell *matHeaderCellDef> Situação </th>
                    <td class = 'pr-5' mat-cell *matCellDef="let element"> 
                       
                        <select class = 'form-control'>
                            <option (click) = 'this.altSit(i.id, element.id);' [selected] = '(i.id == element.fk_situacao) ? "selected": "" ' *ngFor = 'let i of this.listaSituacoes' [value] = 'i.id'>
                                {{i.descricao}}
                            </option>
                        </select>
                    </td>
                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>

                <ng-container matColumnDef="complexidade">
                    <th mat-header-cell *matHeaderCellDef> Complexidade </th>
                    <td mat-cell *matCellDef="let element"> {{element.complexidade}} </td>
                    <td mat-footer-cell *matFooterCellDef>
                         <div class = 'total mt-2'>Planejado</div> 
                         <div class = 'total'>Executado</div> 
                    </td>
                </ng-container>

                <ng-container matColumnDef="valor">
                    <th mat-header-cell *matHeaderCellDef> Valor </th>
                    <td mat-cell *matCellDef="let element"> {{element.valor}} </td>                   
                    <td mat-footer-cell *matFooterCellDef>
                        <div class = 'total mt-2'>{{this.valorPlanejado}} </div>
                        <div class = 'total'>{{this.valorExecutado}} </div>
                         
                    </td>
                </ng-container>

                <ng-container matColumnDef="acoes">
                    <th mat-header-cell *matHeaderCellDef> Opções </th>

                    <td mat-cell *matCellDef="let element">
                        <i (click) = 'open(content); this.tarefaAtual(element.id);' class="fa fa-trash-o fa-2x deletar custom-icon" aria-hidden="true" placement="top" ngbTooltip = "Excluir"></i>
                        <i (click) = 'this.tarefaAtual(element.id); this.editaTarefa(element);' class="fa fa-pencil-square-o fa-2x editar custom-icon" aria-hidden="true" placement="top" ngbTooltip = "Editar"></i>
                    </td>                      

                    <td mat-footer-cell *matFooterCellDef></td>
                </ng-container>

                
                
                <tr mat-header-row *matHeaderRowDef="colunas; sticky: true"></tr> 
                <tr mat-row *matRowDef="let row; columns: colunas;" ></tr>    
                <tr mat-footer-row *matFooterRowDef="colunas;"></tr>            
                
            </table>
        </div>
        
    </div>


    <ng-template #naoHaTarefas>
        <div class = 'container'>

            <div class="alert alert-warning" role="alert">
                Você ainda não possui tarefas cadastradas nessa Ordem de Fornecimento
            </div>            
        
        </div>
    </ng-template>


        

</div>

<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Deletar Tarefa</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <i class="d-flex justify-content-center fa fa-exclamation-circle fa-4x deletar" aria-hidden="true"></i>
    <h4 class="d-flex justify-content-center" >Você tem certeza?</h4>
    <p class = 'text-muted d-flex justify-content-center'>A tarefa será deletada permanentemente</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" (click)="c('Save click')">Cancelar</button>
    <button type="button" class="btn btn-outline-danger" (click)="c('Save click'); this.excluiTarefa();">Excluir Tarefa</button>
  </div>
</ng-template>


