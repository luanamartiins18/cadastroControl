<div class='wrapper' *ngIf='this.relatorioExpandido; else carregando'>

  <div class='title px-5 py-5'>
    <mat-card class='px-4'>
      <mat-card-title class='mb-3'>
        <h4>
          Relatório por Sigla/Referência
        </h4>
      </mat-card-title>
      <mat-card-content class='mt-4 card mat-elevation-z8'>
        <div class='card-header'>
          <div class='form-row mb-0'>
            <div class='form-group col-sm-3 mb-0 mr-3'>
              <label class='mb-0' for="referencia">
                <h6>Referência</h6>
              </label>
              <div class='input-group'>
                <input (keyup.enter)='this.filtraRelatorio();' [(ngModel)]='filtro.referencia' mask="00/0000"
                  type="text" class='input-group-prepend form-control form-control-sm' placeholder='mes/ano'
                  id='referencia' />
                <div class="input-group-append">
                  <button (click)='this.filtraRelatorio();' class="btn btn-sm btn-secondary" type="button">
                    <i class="fa fa-search" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
              <small class='cursor-pointer' (click)='this.resetaRelatorio();'>Resetar Formulário</small>
            </div>
          </div>
        </div>

        <div class='card-body px-0 py-0'>
          <table mat-table [dataSource]="this.relatorioReduzido">
            <ng-container matColumnDef="sigla">
              <th mat-header-cell *matHeaderCellDef> Sigla </th>
              <td mat-cell *matCellDef="let element"> {{element.sigla}} </td>
            </ng-container>
            <ng-container matColumnDef="qtd">
              <th mat-header-cell *matHeaderCellDef> Qtd OF </th>
              <td mat-cell *matCellDef="let element"> {{element.qtd}} </td>
            </ng-container>
            <ng-container matColumnDef="valor_ustibb">
              <th mat-header-cell *matHeaderCellDef> UstiBB </th>
              <td mat-cell *matCellDef="let element"> {{element.valor_ustibb}} </td>
            </ng-container>
            <ng-container matColumnDef="valor">
              <th mat-header-cell *matHeaderCellDef> Valor </th>
              <td mat-cell *matCellDef="let element"> R$ {{element.valor}} </td>
            </ng-container>
            <ng-container matColumnDef="referencia">
              <th mat-header-cell *matHeaderCellDef> Referência </th>
              <td mat-cell *matCellDef="let element"> {{element.referencia | mask: "00/0000"}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="this.colunasReduzido"></tr>
            <tr (click)='detalha(row);' class='custom-row' mat-row *matRowDef="let row; columns: this.colunasReduzido;">
            </tr>
          </table>
        </div>
      </mat-card-content>

      <button (click)='this.getRelatorioSiglaReferenciaXlsx();' class="btn btn-success">
        <i class="label-btn-cinza fa fa-table mr-2" aria-hidden="true"></i>
        <span class='label-btn-cinza fonte-btn-cinza'>Exportar xlsx</span>
      </button>

    </mat-card>
  </div>

</div>

<ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">
      <i class="fa fa-list-alt" aria-hidden="true"></i> Relatório Sigla</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <div *ngIf='this.relatorioExpandido; else carregando'>
      <table mat-table [dataSource]="this.relatorioReduzido">
        <ng-container matColumnDef="sigla">
          <th mat-header-cell *matHeaderCellDef> Sigla </th>
          <td mat-cell *matCellDef="let element"> {{element.sigla}} </td>
        </ng-container>
        <ng-container matColumnDef="qtd">
          <th mat-header-cell *matHeaderCellDef> Qtd OF </th>
          <td mat-cell *matCellDef="let element"> {{element.qtd}} </td>
        </ng-container>
        <ng-container matColumnDef="valor_ustibb">
          <th mat-header-cell *matHeaderCellDef> UstiBB </th>
          <td mat-cell *matCellDef="let element"> {{element.valor_ustibb}} </td>
        </ng-container>
        <ng-container matColumnDef="valor">
          <th mat-header-cell *matHeaderCellDef> Valor </th>
          <td mat-cell *matCellDef="let element"> R$ {{element.valor}} </td>
        </ng-container>
        <ng-container matColumnDef="referencia">
          <th mat-header-cell *matHeaderCellDef> Referência </th>
          <td mat-cell *matCellDef="let element"> {{element.referencia | mask: "00/0000"}} </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="this.colunasReduzido"></tr>
        <tr (click)='expandir(row);' class='custom-row' mat-row *matRowDef="let row; columns: this.colunasReduzido;">
        </tr>
      </table>
    </div>
  </div>

  <div class="modal-footer">
    <button (click)='this.getRelatorioSiglaReferenciaXlsx();' class="btn btn-success">
      <i class="label-btn-cinza fa fa-table mr-2" aria-hidden="true"></i>
      <span class='label-btn-cinza fonte-btn-cinza'>Exportar xlsx</span>
    </button>
  </div>
</ng-template>



<ng-template #carregando>
  <div class='wrapper d-flex justify-content-center align-items-center'>
    <i class="fa fa-refresh fa-spin fa-5x" aria-hidden="true"></i>
  </div>
</ng-template>